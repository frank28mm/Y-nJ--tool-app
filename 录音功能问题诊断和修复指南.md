# 录音功能问题诊断和修复指南

## 问题分析

录音功能无法工作的主要原因是现代浏览器的安全策略要求HTTPS环境才能访问麦克风权限。

## 解决方案

### 方案1：在Chrome中手动允许HTTP麦克风权限（推荐用于开发环境）

1. 打开Chrome浏览器
2. 访问 `http://localhost:5174`
3. 进入复述训练页面
4. 点击"开始录音"按钮
5. 如果出现权限提示，点击"允许"
6. 如果没有权限提示：
   - 点击地址栏左侧的"不安全"或锁形图标
   - 选择"网站设置"
   - 将"麦克风"权限设置为"允许"
   - 刷新页面

### 方案2：使用Chrome的不安全源标志（开发环境）

1. 关闭所有Chrome窗口
2. 使用以下命令启动Chrome：
   ```bash
   # macOS
   /Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --unsafely-treat-insecure-origin-as-secure=http://localhost:5174 --user-data-dir=/tmp/chrome-dev
   
   # Windows
   chrome.exe --unsafely-treat-insecure-origin-as-secure=http://localhost:5174 --user-data-dir=c:\temp\chrome-dev
   ```
3. 访问 `http://localhost:5174`

### 方案3：配置HTTPS开发环境（生产环境推荐）

如果需要完整的HTTPS支持，可以：

1. 安装mkcert生成本地证书：
   ```bash
   # macOS
   brew install mkcert
   mkcert -install
   mkcert localhost 127.0.0.1 ::1
   ```

2. 修改`vite.config.ts`：
   ```typescript
   server: {
     https: {
       key: fs.readFileSync('localhost-key.pem'),
       cert: fs.readFileSync('localhost.pem')
     },
     host: true
   }
   ```

## 功能测试步骤

1. 打开浏览器开发者工具（F12）
2. 进入复述训练页面
3. 点击"开始录音"按钮
4. 观察控制台输出：
   - 应该看到"开始语音识别..."日志
   - 如果出现权限错误，按照上述方案解决
5. 对着麦克风说话
6. 观察是否有"语音识别结果:"日志输出
7. 点击"停止录音"测试完整流程

## 常见错误和解决方法

### 错误1："麦克风权限被拒绝"
- **解决方法**：按照方案1手动允许权限

### 错误2："未找到麦克风设备"
- **解决方法**：检查系统麦克风设备是否正常工作

### 错误3："语音识别不可用"
- **解决方法**：确保使用支持Web Speech API的浏览器（Chrome、Edge等）

### 错误4："网络连接失败"
- **解决方法**：检查网络连接，语音识别需要联网

## 代码修改说明

已对代码进行以下优化：

1. **改进错误提示**：在`ParaphrasePage.vue`中添加了详细的用户指导信息
2. **权限检查**：增强了语音识别兼容性检测
3. **错误处理**：改进了各种错误情况的处理和用户反馈

## 验证录音功能是否正常

1. 打开 `http://localhost:5174`
2. 登录后进入"学习"页面
3. 选择任意段落进入"复述训练"
4. 点击"开始录音"按钮
5. 允许麦克风权限（如果提示）
6. 对着麦克风朗读原文内容
7. 点击"停止录音"
8. 查看是否显示转录文本和AI评估结果

如果以上步骤都正常，说明录音功能已修复成功。